package com.suse.matcher.rules;

import java.util.List;

import com.suse.matcher.model.Match;
import com.suse.matcher.model.Match.Kind;
import com.suse.matcher.model.Subscription;
import com.suse.matcher.model.System;

rule "installed product matches subscription"
    agenda-group "Matchability"
    when
        $system : System()
        $subscription : Subscription( matchAnyProductOnSystem($system),
            (stackable == true || cpus >= $system.cpus ),
            (
                (virtualizationPolicy == Subscription.PHYSICAL_ONLY && $system.physical) ||
                (virtualizationPolicy == Subscription.UNLIMITED_VIRTUALIZATION && $system.physical)
                // TWO_TWO can be applied to both physical and virtual systems
            )
        )
    then
        insert(new Match($system.id, $subscription.id, Kind.POSSIBLE));
end
